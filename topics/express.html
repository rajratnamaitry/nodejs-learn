<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Express | Nodejs learning</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/nodejs-learn/assets/css/0.styles.4907d4ea.css" as="style"><link rel="preload" href="/nodejs-learn/assets/js/app.23f6b257.js" as="script"><link rel="preload" href="/nodejs-learn/assets/js/2.d2b89f10.js" as="script"><link rel="preload" href="/nodejs-learn/assets/js/9.08ee6730.js" as="script"><link rel="prefetch" href="/nodejs-learn/assets/js/10.59ec8eb4.js"><link rel="prefetch" href="/nodejs-learn/assets/js/3.bb5f88a2.js"><link rel="prefetch" href="/nodejs-learn/assets/js/4.81a0d541.js"><link rel="prefetch" href="/nodejs-learn/assets/js/5.7e1779cf.js"><link rel="prefetch" href="/nodejs-learn/assets/js/6.2fb69200.js"><link rel="prefetch" href="/nodejs-learn/assets/js/7.368e280e.js"><link rel="prefetch" href="/nodejs-learn/assets/js/8.53e489a3.js">
    <link rel="stylesheet" href="/nodejs-learn/assets/css/0.styles.4907d4ea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nodejs-learn/" class="home-link router-link-active"><!----> <span class="site-name">Nodejs learning</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nodejs-learn/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/nodejs-learn/topics/basics.html" class="nav-link">
  Basics
</a></div><div class="nav-item"><a href="/nodejs-learn/topics/express.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Express
</a></div><div class="nav-item"><a href="/nodejs-learn/topics/mongodb.html" class="nav-link">
  Mongo DB
</a></div> <a href="https://github.com/rajratnamaitry/nodejs-learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nodejs-learn/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/nodejs-learn/topics/basics.html" class="nav-link">
  Basics
</a></div><div class="nav-item"><a href="/nodejs-learn/topics/express.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Express
</a></div><div class="nav-item"><a href="/nodejs-learn/topics/mongodb.html" class="nav-link">
  Mongo DB
</a></div> <a href="https://github.com/rajratnamaitry/nodejs-learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Express</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodejs-learn/topics/express.html#create-app" class="sidebar-link">Create app</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-learn/topics/express.html#express-application-generator" class="sidebar-link">Express application generator</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-learn/topics/express.html#serving-static-files-in-express" class="sidebar-link">Serving static files in Express</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-learn/topics/express.html#routing" class="sidebar-link">Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#using-defining-mathod-and-url-path" class="sidebar-link">Using defining mathod and url path</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#examples-of-route-paths-based-on-regular-expressions" class="sidebar-link">Examples of route paths based on regular expressions:</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#route-parameters" class="sidebar-link">Route parameters</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#route-handlers" class="sidebar-link">Route handlers</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#response-methods" class="sidebar-link">Response methods</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#using-app-route" class="sidebar-link">Using app.route()</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#using-express-router" class="sidebar-link">Using express router</a></li></ul></li><li><a href="/nodejs-learn/topics/express.html#middleware" class="sidebar-link">Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#perform-the-following-tasks" class="sidebar-link">Perform the following tasks:</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#configurable-middleware" class="sidebar-link">Configurable middleware</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#application-level-middleware" class="sidebar-link">Application-level middleware</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#router-level-middleware" class="sidebar-link">Router-level middleware</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#error-handling-middleware" class="sidebar-link">Error-handling middleware</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#built-in-middleware" class="sidebar-link">Built-in middleware</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#third-party-middleware" class="sidebar-link">Third-party middleware</a></li></ul></li><li><a href="/nodejs-learn/topics/express.html#overriding-the-express-api" class="sidebar-link">Overriding the Express API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-learn/topics/express.html#express-behind-proxies" class="sidebar-link">Express behind proxies</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-learn/topics/express.html#process-managers-for-express-apps" class="sidebar-link">Process managers for Express apps</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-learn/topics/express.html#best-practices-security" class="sidebar-link">Best Practices: Security</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#don-t-use-deprecated-or-vulnerable-versions" class="sidebar-link">Don’t use deprecated or vulnerable versions</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#use-tls" class="sidebar-link">Use TLS</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#use-helmet" class="sidebar-link">Use Helmet</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#reduce-fingerprinting" class="sidebar-link">Reduce Fingerprinting</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#use-cookies-securely" class="sidebar-link">Use cookies securely</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#prevent-brute-force-attacks-against-authorization" class="sidebar-link">Prevent brute-force attacks against authorization</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#ensure-your-dependencies-are-secure" class="sidebar-link">Ensure your dependencies are secure</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#additional-considerations" class="sidebar-link">Additional considerations</a></li></ul></li><li><a href="/nodejs-learn/topics/express.html#performance-and-reliability" class="sidebar-link">Performance and reliability</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#use-gzip-compression" class="sidebar-link">Use gzip compression</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#don-t-use-synchronous-functions" class="sidebar-link">Don’t use synchronous functions</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#do-logging-correctly" class="sidebar-link">Do logging correctly</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#handle-exceptions-properly" class="sidebar-link">Handle exceptions properly</a></li></ul></li><li><a href="/nodejs-learn/topics/express.html#things-to-do-in-your-environment-setup" class="sidebar-link">Things to do in your environment / setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#set-node-env-to-production" class="sidebar-link">Set NODE_ENV to “production”</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#ensure-your-app-automatically-restarts" class="sidebar-link">Ensure your app automatically restarts</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#run-your-app-in-a-cluster" class="sidebar-link">Run your app in a cluster</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#cache-request-results" class="sidebar-link">Cache request results</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#use-a-load-balancer" class="sidebar-link">Use a load balancer</a></li><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#use-a-reverse-proxy" class="sidebar-link">Use a reverse proxy</a></li></ul></li><li><a href="/nodejs-learn/topics/express.html#graceful-shutdown" class="sidebar-link">Graceful shutdown</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-learn/topics/express.html#health-checks" class="sidebar-link">Health checks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs-learn/topics/express.html#express-actuator" class="sidebar-link">Express-actuator</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="express"><a href="#express" class="header-anchor">#</a> Express</h1> <div class="language-CMD extra-class"><pre class="language-text"><code>&quot;express&quot;: &quot;^4.17.1&quot;,
</code></pre></div><h2 id="create-app"><a href="#create-app" class="header-anchor">#</a> Create app</h2> <ul><li>Using Express function create app object and add  port to listen method</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Example app listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="express-application-generator"><a href="#express-application-generator" class="header-anchor">#</a> Express application generator</h2> <ul><li>Can generate new application with view engine</li></ul> <h2 id="serving-static-files-in-express"><a href="#serving-static-files-in-express" class="header-anchor">#</a> Serving static files in Express</h2> <ul><li>To use multiple static assets directories, call the express.static middleware function multiple times:</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// http://localhost:3000/images/kitten.jpg</span>
<span class="token comment">// http://localhost:3000/css/style.css</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/static'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// http://localhost:3000/static/images/kitten.jpg</span>
<span class="token comment">// http://localhost:3000/static/css/style.css</span>
</code></pre></div><h2 id="routing"><a href="#routing" class="header-anchor">#</a> Routing</h2> <h3 id="using-defining-mathod-and-url-path"><a href="#using-defining-mathod-and-url-path" class="header-anchor">#</a> Using defining mathod and url path</h3> <ul><li>aap.METHOD(url)</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// GET method route</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'GET request to the homepage'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// POST method route</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'POST request to the homepage'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//  the following handler is executed for requests to the route “/secret” whether using GET, POST, PUT, DELETE, or any other HTTP request method supported</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'/secret'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Accessing the secret section ...'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// pass control to the next handler</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="examples-of-route-paths-based-on-regular-expressions"><a href="#examples-of-route-paths-based-on-regular-expressions" class="header-anchor">#</a> Examples of route paths based on regular expressions:</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// This route path will match anything with an “a” in it.</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">a</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// This route path will match butterfly and dragonfly, but not butterflyman, dragonflyman, and so on.</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*fly$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="route-parameters"><a href="#route-parameters" class="header-anchor">#</a> Route parameters</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * Route path: /users/:userId/books/:bookId
 * Request URL: http://localhost:3000/users/34/books/8989
 * req.params: { &quot;userId&quot;: &quot;34&quot;, &quot;bookId&quot;: &quot;8989&quot; }
*/</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users/:userId/books/:bookId'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Since the hyphen (-) and the dot (.) are interpreted literally, they can be used along with route parameters for useful purposes.</span>
<span class="token comment">/**
 * Route path: /flights/:from-:to
 * Request URL: http://localhost:3000/flights/LAX-SFO
 * req.params: { &quot;from&quot;: &quot;LAX&quot;, &quot;to&quot;: &quot;SFO&quot; }
 * Route path: /plantae/:genus.:species
 * Request URL: http://localhost:3000/plantae/Prunus.persica
 * req.params: { &quot;genus&quot;: &quot;Prunus&quot;, &quot;species&quot;: &quot;persica&quot; }
 */</span>
</code></pre></div><h3 id="route-handlers"><a href="#route-handlers" class="header-anchor">#</a> Route handlers</h3> <p>More than one callback function can handle a route</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/example/b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'the response will be sent by the next function ...'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello from B!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/example/c'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb0<span class="token punctuation">,</span> cb1<span class="token punctuation">,</span> cb2<span class="token punctuation">]</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/example/d'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb0<span class="token punctuation">,</span> cb1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'the response will be sent by the next function ...'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello from D!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="response-methods"><a href="#response-methods" class="header-anchor">#</a> Response methods</h3> <table><thead><tr><th>Method</th> <th>Description</th></tr></thead> <tbody><tr><td>res.download()</td> <td>Prompt a file to be downloaded.</td></tr> <tr><td>res.end()</td> <td>End the response process.</td></tr> <tr><td>res.json()</td> <td>Send a JSON response.</td></tr> <tr><td>res.jsonp()</td> <td>Send a JSON response with JSONP support.</td></tr> <tr><td>res.redirect()</td> <td>Redirect a request.</td></tr> <tr><td>res.render()</td> <td>Render a view template.</td></tr> <tr><td>res.send()</td> <td>Send a response of various types.</td></tr> <tr><td>res.sendFile()</td> <td>Send a file as an octet stream.</td></tr> <tr><td>res.sendStatus()</td> <td>Set the response status code and send its string representation as the response body.</td></tr></tbody></table> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// redirect</span>
res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'http://example.com'</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">,</span> <span class="token string">'http://example.com'</span><span class="token punctuation">)</span>
<span class="token comment">// render</span>
res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// status send </span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Sorry, we cannot find that!'</span><span class="token punctuation">)</span>
<span class="token comment">// send file</span>
<span class="token keyword">var</span> fileName <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name
res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Sent:'</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="using-app-route"><a href="#using-app-route" class="header-anchor">#</a> Using app.route()</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'/book'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Get a random book'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Add a book'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Update the book'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="using-express-router"><a href="#using-express-router" class="header-anchor">#</a> Using express router</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// routes/tourRouters.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> toursController <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/toursController'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// middleware that is specific to this router</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Time: '</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router
    <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>toursController<span class="token punctuation">.</span>getAllTour<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>toursController<span class="token punctuation">.</span>addTour<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>

<span class="token comment">// app.js</span>
<span class="token keyword">const</span> tourRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/tourRouters'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api/v2/tour'</span><span class="token punctuation">,</span>tourRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h2> <h3 id="perform-the-following-tasks"><a href="#perform-the-following-tasks" class="header-anchor">#</a> Perform the following tasks:</h3> <ul><li>Execute any code.</li> <li>Make changes to the request and the response objects.</li> <li>End the request-response cycle.</li> <li>Call the next middleware in the stack.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">myLogger</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LOGGED'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>myLogger<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="configurable-middleware"><a href="#configurable-middleware" class="header-anchor">#</a> Configurable middleware</h3> <p>export a function which accepts an options object or other parameters, which, then returns the middleware implementation based on the input parameters</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// my-middleware.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Implement the middleware function based on the options object</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// app.js</span>
<span class="token keyword">const</span> mw <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./my-middleware.js'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">mw</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">option1</span><span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token literal-property property">option2</span><span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="application-level-middleware"><a href="#application-level-middleware" class="header-anchor">#</a> Application-level middleware</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Time:'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="router-level-middleware"><a href="#router-level-middleware" class="header-anchor">#</a> Router-level middleware</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// a middleware function with no mount path. This code is executed for every request to the router</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Time:'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// a middleware sub-stack shows request info for any type of HTTP request to the /user/:id path</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request URL:'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>originalUrl<span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request Type:'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>method<span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// a middleware sub-stack that handles GET requests to the /user/:id path</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// if the user ID is 0, skip to the next router</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'route'</span><span class="token punctuation">)</span>
  <span class="token comment">// otherwise pass control to the next middleware function in this stack</span>
  <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// render a regular page</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'regular'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// mount the router on the app</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="error-handling-middleware"><a href="#error-handling-middleware" class="header-anchor">#</a> Error-handling middleware</h3> <p>Except with four arguments instead of three, specifically with the signature (err, req, res, next)):</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Something broke!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="built-in-middleware"><a href="#built-in-middleware" class="header-anchor">#</a> Built-in middleware</h3> <ul><li>express.static serves static assets such as HTML files, images, and so on.</li> <li>express.json parses incoming requests with JSON payloads. NOTE: Available with Express 4.16.0+</li> <li>express.urlencoded parses incoming requests with URL-encoded payloads. NOTE: Available with Express 4.16.0+</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="third-party-middleware"><a href="#third-party-middleware" class="header-anchor">#</a> Third-party middleware</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>
<span class="token comment">// load the cookie-parsing middleware</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="overriding-the-express-api"><a href="#overriding-the-express-api" class="header-anchor">#</a> Overriding the Express API</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function-variable function">sendStatus</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">statusCode<span class="token punctuation">,</span> type<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// code is intentionally kept simple for demonstration purpose</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// </span>
res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span> <span class="token string">'{&quot;error&quot;:&quot;resource not found&quot;}'</span><span class="token punctuation">)</span>
<span class="token comment">//</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token string">'ip'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Client-IP'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//</span>

</code></pre></div><h2 id="express-behind-proxies"><a href="#express-behind-proxies" class="header-anchor">#</a> Express behind proxies</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// You can set IP addresses in any of the following ways:</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback'</span><span class="token punctuation">)</span> <span class="token comment">// specify a single subnet</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback, 123.123.123.123'</span><span class="token punctuation">)</span> <span class="token comment">// specify a subnet and an address</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback, linklocal, uniquelocal'</span><span class="token punctuation">)</span> <span class="token comment">// specify multiple subnets as CSV</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'loopback'</span><span class="token punctuation">,</span> <span class="token string">'linklocal'</span><span class="token punctuation">,</span> <span class="token string">'uniquelocal'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// specify multiple subnets as an array</span>

<span class="token comment">// Custom trust implementation.</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ip</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ip <span class="token operator">===</span> <span class="token string">'127.0.0.1'</span> <span class="token operator">||</span> ip <span class="token operator">===</span> <span class="token string">'123.123.123.123'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// trusted IPs</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="process-managers-for-express-apps"><a href="#process-managers-for-express-apps" class="header-anchor">#</a> Process managers for Express apps</h2> <p>When you run Express apps for production, it is helpful to use a process manager to:</p> <ul><li>Restart the app automatically if it crashes.</li> <li>Gain insights into runtime performance and resource consumption.</li> <li>Modify settings dynamically to improve performance.</li> <li>Control clustering</li></ul> <p>The most popular process managers for Express and other Node.js applications are:</p> <ul><li>Forever: A simple command-line interface tool to ensure that a script runs continuously (forever). Forever’s simple interface makes it ideal for running smaller deployments of Node.js apps and scripts.</li> <li>PM2: A production process manager for Node.js applications that has a built-in load balancer. PM2 enables you to keep applications alive forever, reloads them without downtime, helps you to manage application logging, monitoring, and clustering.</li></ul> <h2 id="best-practices-security"><a href="#best-practices-security" class="header-anchor">#</a> Best Practices: Security</h2> <h3 id="don-t-use-deprecated-or-vulnerable-versions"><a href="#don-t-use-deprecated-or-vulnerable-versions" class="header-anchor">#</a> Don’t use deprecated or vulnerable versions</h3> <p>Express 2.x and 3.x are no longer maintained.</p> <h3 id="use-tls"><a href="#use-tls" class="header-anchor">#</a> Use TLS</h3> <p>If your app deals with or transmits sensitive data, use Transport Layer Security (TLS) to secure the connection and the data. This technology encrypts data before it is sent from the client to the server</p> <h3 id="use-helmet"><a href="#use-helmet" class="header-anchor">#</a> Use Helmet</h3> <p>Helmet can help protect your app from some well-known web vulnerabilities by setting HTTP headers appropriately.</p> <h3 id="reduce-fingerprinting"><a href="#reduce-fingerprinting" class="header-anchor">#</a> Reduce Fingerprinting</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token string">'x-powered-by'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="use-cookies-securely"><a href="#use-cookies-securely" class="header-anchor">#</a> Use cookies securely</h3> <ul><li>express.session middleware built-in to Express 3.x.</li> <li>express.cookieSession middleware built-in to Express 3.x.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> expiryDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 1 hour</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'session'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">keys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token string">'example.com'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'foo/bar'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">expires</span><span class="token operator">:</span> expiryDate
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="prevent-brute-force-attacks-against-authorization"><a href="#prevent-brute-force-attacks-against-authorization" class="header-anchor">#</a> Prevent brute-force attacks against authorization</h3> <ul><li>The first is number of consecutive failed attempts by the same user name and IP address.</li> <li>The second is number of failed attempts from an IP address over some long period of time. For example, block an IP address if it makes 100 failed attempts in one day.</li></ul> <h3 id="ensure-your-dependencies-are-secure"><a href="#ensure-your-dependencies-are-secure" class="header-anchor">#</a> Ensure your dependencies are secure</h3> <div class="language-CMD extra-class"><pre class="language-text"><code>npm audit
... 
npm install -g snyk
// Use this command to test your application for vulnerabilities:
snyk test

</code></pre></div><h3 id="additional-considerations"><a href="#additional-considerations" class="header-anchor">#</a> Additional considerations</h3> <ul><li>Always filter and sanitize user input to protect against cross-site scripting (XSS) and command injection attacks.</li> <li>Defend against SQL injection attacks by using parameterized queries or prepared statements.</li> <li>Use the open-source sqlmap tool to detect SQL injection vulnerabilities in your app.</li> <li>Use the nmap and sslyze tools to test the configuration of your SSL ciphers, keys, and renegotiation as well as the validity of your certificate.</li></ul> <h2 id="performance-and-reliability"><a href="#performance-and-reliability" class="header-anchor">#</a> Performance and reliability</h2> <p>Here are some things you can do in your code to improve your application’s performance:</p> <h3 id="use-gzip-compression"><a href="#use-gzip-compression" class="header-anchor">#</a> Use gzip compression</h3> <p>Gzip compressing can greatly decrease the size of the response body and hence increase the speed of a web app.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> compression <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">compression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="don-t-use-synchronous-functions"><a href="#don-t-use-synchronous-functions" class="header-anchor">#</a> Don’t use synchronous functions</h3> <p>Synchronous functions and methods tie up the executing process until they return.</p> <h3 id="do-logging-correctly"><a href="#do-logging-correctly" class="header-anchor">#</a> Do logging correctly</h3> <p>Using console.log() or console.error() to print log messages to the terminal is common practice in development. But these functions are synchronous when the destination is a terminal or a file, so they are not suitable for production, unless you pipe the output to another program.</p> <h3 id="handle-exceptions-properly"><a href="#handle-exceptions-properly" class="header-anchor">#</a> Handle exceptions properly</h3> <ul><li>Use try-catch</li> <li>Use promises</li></ul> <h2 id="things-to-do-in-your-environment-setup"><a href="#things-to-do-in-your-environment-setup" class="header-anchor">#</a> Things to do in your environment / setup</h2> <h3 id="set-node-env-to-production"><a href="#set-node-env-to-production" class="header-anchor">#</a> Set NODE_ENV to “production”</h3> <ul><li>Cache view templates.</li> <li>Cache CSS files generated from CSS extensions.</li> <li>Generate less verbose error messages.</li></ul> <h3 id="ensure-your-app-automatically-restarts"><a href="#ensure-your-app-automatically-restarts" class="header-anchor">#</a> Ensure your app automatically restarts</h3> <p>Using a process manager to restart the app (and Node) when it crashes.</p> <h3 id="run-your-app-in-a-cluster"><a href="#run-your-app-in-a-cluster" class="header-anchor">#</a> Run your app in a cluster</h3> <h3 id="cache-request-results"><a href="#cache-request-results" class="header-anchor">#</a> Cache request results</h3> <h3 id="use-a-load-balancer"><a href="#use-a-load-balancer" class="header-anchor">#</a> Use a load balancer</h3> <p>One way to scale an app is to run multiple instances of it and distribute the traffic via a load balancer. Setting up a load balancer can improve your app’s performance and speed, and enable it to scale more than is possible with a single instance.</p> <p>A load balancer is usually a reverse proxy that orchestrates traffic to and from multiple application instances and servers. You can easily set up a load balancer for your app by using Nginx or HAProxy.</p> <h3 id="use-a-reverse-proxy"><a href="#use-a-reverse-proxy" class="header-anchor">#</a> Use a reverse proxy</h3> <p>A reverse proxy sits in front of a web app and performs supporting operations on the requests, apart from directing requests to the app. It can handle error pages, compression, caching, serving files, and load balancing among other things.</p> <h2 id="graceful-shutdown"><a href="#graceful-shutdown" class="header-anchor">#</a> Graceful shutdown</h2> <p>When you deploy a new version of your application, you must replace the previous version. The process manager you’re using will first send a SIGTERM signal to the application to notify it that it will be killed. Once the application gets this signal, it should stop accepting new requests, finish all the ongoing requests, clean up the resources it used, including database connections and file locks then exit.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'SIGTERM signal received: closing HTTP server'</span><span class="token punctuation">)</span>
  server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'HTTP server closed'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="health-checks"><a href="#health-checks" class="header-anchor">#</a> Health checks</h2> <p>A load balancer uses health checks to determine if an application instance is healthy and can accept requests.</p> <h3 id="express-actuator"><a href="#express-actuator" class="header-anchor">#</a> Express-actuator</h3> <p>express-actuator is a middleware to add endpoints to help you monitor and manage applications.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> actuator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-actuator'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">actuator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/nodejs-learn/assets/js/app.23f6b257.js" defer></script><script src="/nodejs-learn/assets/js/2.d2b89f10.js" defer></script><script src="/nodejs-learn/assets/js/9.08ee6730.js" defer></script>
  </body>
</html>
